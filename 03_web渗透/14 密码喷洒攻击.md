# Alert (TA18-086A)

## [Brute Force Attacks Conducted by Cyber Actors][https://us-cert.cisa.gov/ncas/alerts/TA18-086A]

**本文完全是谷歌翻译，原文链接：https://us-cert.cisa.gov/ncas/alerts/TA18-086A**



### 受影响的系统

联网系统



### 概述

根据 FBI 调查得出的信息，恶意网络攻击者越来越多地使用一种被称为密码喷射的暴力攻击方式，攻击美国和国外的组织。

2018 年 2 月，纽约南区司法部以与本报告所述活动相关的计算机入侵罪名起诉与 Mabna 研究所有关联的 9 名伊朗国民。此处描述的技术和活动虽然是 Mabna 演员的特征，但并不仅限于此组使用。

国土安全部 (DHS) 和联邦调查局 (FBI) 正在发布此警报，以提供有关此活动的更多信息。



### 描述

在传统的蛮力攻击中，恶意行为者试图通过猜测密码来未经授权访问单个帐户。这会很快导致目标帐户被锁定，因为常用的帐户锁定策略允许在设定的时间段内进行三到五次错误尝试。在密码喷射攻击（也称为“低速和慢速”方法）期间，恶意行为者在继续尝试使用第二个密码之前尝试针对多个帐户使用一个密码，依此类推。该技术通过避免快速或频繁的帐户锁定来使攻击者不被发现。

密码喷洒活动通常针对使用联合身份验证协议的单点登录 (SSO) 和基于云的应用程序。攻击者可能会针对此特定协议，因为联合身份验证可以帮助屏蔽恶意流量。此外，通过针对 SSO 应用程序，恶意行为者希望在成功入侵期间最大限度地访问知识产权。 

电子邮件应用程序也有针对性。在这些情况下，恶意行为者将能够利用收件箱同步来 (1) 直接从云中获得对组织电子邮件的未经授权的访问，(2) 随后将用户邮件下载到本地存储的电子邮件文件中，(3) 识别整个公司的电子邮件电子邮件地址列表，和/或 (4) 暗中实施收件箱规则以转发已发送和已接收的邮件。

### 技术细节

进行密码喷射攻击的传统策略、技术和程序 (TTP) 如下：

- 使用社会工程策略进行在线研究（即 Google 搜索、LinkedIn 等）以识别目标组织和特定用户帐户以进行初始密码喷洒
- 使用易于猜测的密码（例如，“Winter2018”、“Password123！”）和公开可用的工具，利用已识别的 SSO 或基于 Web 的应用程序和联合身份验证方法对目标帐户执行密码喷射攻击
- 利用初始受感染帐户组，从目标的电子邮件客户端下载全局地址列表 (GAL)，并对合法帐户执行更大的密码喷射
- 使用受损访问，尝试在网络内横向扩展（例如，通过远程桌面协议），并使用 FileZilla 等文件传输协议工具执行大量数据泄露

密码喷射攻击的指标包括：

- 尝试登录企业 SSO 门户或基于 Web 的应用程序的数量激增；
    - 使用自动化工具，恶意行为者快速连续地尝试针对受害企业的多个用户帐户进行数千次登录，这些帐户源自单个 IP 地址和计算机（例如，一个通用的用户代理字符串）。
    - 已经看到攻击持续了两个多小时。
- 员工从 IP 地址登录，地址解析到与其正常位置不一致的位置。

### 典型的受害者环境

绝大多数已知的密码喷洒受害者都具有以下一些特征[[1] ](https://us-cert.cisa.gov/ncas/tips/ST04-002)[[2]](https://us-cert.cisa.gov/ncas/tips/ST05-012)：

- 使用具有联合身份验证方法的 SSO 或基于 Web 的应用程序
- 缺乏多因素身份验证 (MFA)
- 允许易于猜测的密码（例如，“Winter2018”、“Password123！”）
- 使用收件箱同步，允许将电子邮件从云环境拉到远程设备
- 允许在用户级别设置电子邮件转发
- 有限的日志设置在事后调查期间造成困难



### 影响

成功的网络入侵可能会产生严重的影响，尤其是在危害公开且敏感信息暴露的情况下。可能的影响包括：

- 暂时或永久丢失敏感或专有信息；
- 干扰正常运营；
- 恢复系统和文件造成的经济损失
- 对组织声誉的潜在损害。



### 推荐的缓解措施

为了帮助阻止这种攻击方式，应采取以下步骤：

- 启用 MFA 并检查 MFA 设置以确保覆盖所有活动的、面向 Internet 的协议。
- 查看密码策略以确保它们符合最新的 NIST 指南[[3]](https://pages.nist.gov/800-63-3/)并阻止使用易于猜测的密码。
- 查看与初始密码、用户锁定密码重置和共享帐户相关的 IT 服务台密码管理。IT 服务台密码程序可能与公司政策不一致，从而造成可利用的安全漏洞。
- 许多公司提供了额外的帮助和工具，可以帮助检测和防止密码喷射攻击，例如 2018 年 3 月 5 日发布的 Microsoft 博客。[[4]](https://cloudblogs.microsoft.com/enterprisemobility/2018/03/05/azure-ad-and-adfs-best-practices-defending-against-password-spray-attacks/)



### 其他防护措施

针对密码喷洒攻击，我们需要对不同的外部服务进行身份验证：

* 有些身份验证程序不会记录从外部服务尝试验证的次数。
* 虽然我们通常看到电子邮件或 VPN 系统要求双因素验证（2FA），但面向外部的即时通讯系统可能不需要。
* 密码重用的可能性非常高。
* 有的时候，当使用 AD 账户多次重复登录失败时，外部系统并不会将此账户锁定。



### 工具

[**ruler**](https://github.com/sensepost/ruler)它支持使用MAPI/HTTP或RPC/HTTP协议与Exchange服务器交互，它的主要用途是，一旦你有了身份凭证，你就可以利用Office/Outlook的一些功能来在受害者的电子邮件帐户上创建规则和表单。

ruler通过对用户名和密码进行匹配来进行账号破解，通过指定用户和密码字典，尝试查找出账号和密码。

```
ruler --domain target.com brute --users ./users.txt --passwords ./passwords.txt
```

一旦我们找到了一个密码，我们就可以使用Ruler来获取Office 365的全局地址列表（GAL）中的所有用户，以查
找更多的电子邮件地址及其所属的电子邮件组。我们继续将获取的这些电子邮件地址通过上面提及的那些密码破解工具来进行破解的尝试，从而获得更多的身份凭证。

或者我们可以利用获取到凭证的用户，对联系人列表发送恶意软件、链接等。

> https://github.com/O365/python-o365



### 参考

[[1] NCCIC/US-CERT Tip ST04-002 – 选择和保护密码](https://www.us-cert.gov/ncas/tips/ST04-002)

[[2] NCCIC/US-CERT Tip ST05-12 – 补充密码](https://www.us-cert.gov/ncas/tips/ST05-012)

[[3] NIST 特别出版物 800-63 – 数字身份指南](https://pages.nist.gov/800-63-3)

[[4] 微软。Azure AD 和 ADFS 最佳实践：防御密码攻击……](https://www.microsoft.com/en-us/microsoft-365/blog/2018/03/05/azure-ad-and-adfs-best-practices-defending-against-password-spray-attacks/)

[[5]Password Spray Attack Definition and Defending yourself](https://www.thewindowsclub.com/password-spray-attack)

